import{i as p,r as h,H as S,E as G,o as b,c as C,a,t as _,u as o,b as r,w as u,M as f,V as $,I as H,j as U,aN as P,F as D,L as Y,P as q,e as J}from"./index-Csy_03Ik.js";import{V as K}from"./VTable-CVQIvV2I.js";import{V as O,b as Q,c as W,a as X}from"./VCard-Dn6rlqdV.js";import"./VGrid-CkWBtd8r.js";import"./VImg-AgknyUsB.js";const Z={style:{margin:"10px",display:"flex","justify-content":"space-between"}},ee={style:{"font-size":"small","margin-left":"10px"}},te={class:"text-center"},se={class:"text-center"},ne=a("th",{class:"text-center"}," Description ",-1),ae={class:"text-center"},oe={class:"text-center"},re={class:"text-center",style:{width:"60pt"}},le={class:"text-center"},ce={class:"text-center"},ie={class:"text-center"},de={class:"text-center",style:{width:"50px"}},ue=["checked","onChange"],pe={__name:"AdminTableList",setup(B){const T=function(t){const e=new Date(t),s=e.getFullYear().toString().slice(-2),n=e.getMonth()+1,v=e.getDate(),x=e.getHours(),R=e.getMinutes();return e.getSeconds(),`${s}-${n}-${v} ${x}:${R}`};p("serverAddress");const w=p("tableAddress");p("postAddress"),p("wikiAddress");const I=p("userAddress"),y=p("auth"),i=h("desc"),l=h("id");function g(t){l.value===t?i.value=i.value==="asc"?"desc":"asc":(l.value=t,i.value="asc"),V()}function V(){l.value,l.value,l.value;const t=c.value.map((e,s)=>e?d.value[s].id:null);d.value.sort((e,s)=>{const n=i.value==="asc"?-1:1;switch(l.value){case"id":return n*(e.id-s.id);case"name":return n*e.name.localeCompare(s.name);case"date":return n*(new Date(e.date)-new Date(s.date));default:return 0}}),c.value=d.value.map(e=>t.includes(e.id))}const d=h([]),k=h([]);async function j(){const t=await fetch(`http://${I}/api/getuserid`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`},credentials:"include"});if(!t.ok)alert("인증에 실패하였습니다.");else return t.json()}async function A(){const t=await j(),e=await fetch(`http://${w}/api/table/read/tables/${t}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`},credentials:"include"});if(!e.ok)console.error(error);else{const s=await e.json();k.value=s.filter(n=>n.name!="main")}d.value=[...k.value],V()}A();async function E(t){(await fetch(`http://${w}/api/table/delete/${t}/${userId}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`},credentials:"include"})).ok||console.error()}const c=h([]);async function z(){const t=[];if(c.value.forEach((s,n)=>{s&&t.push(d.value[n].id)}),t.every(s=>!s)){alert("삭제할 테이블을 선택하십시오.");return}if(t.includes(1)){alert("삭제할 수 없는 테이블 입니다.");return}if(confirm("삭제하시겠습니까?")){try{for(const s of t)await E(s);c.value=[],alert("삭제되었습니다.")}catch(s){console.error(s),alert("삭제할 수 없습니다.")}A()}}const m=h(!1);function N(){c.value=d.value.map(()=>m.value)}function F(t){c.value[t]=!c.value[t],m.value=c.value.every(e=>e)}const L=S();function M(t){L.push({path:`/mytables/${t}`})}return(t,e)=>{const s=G("VIconBtn");return b(),C(D,null,[a("div",Z,[a("span",ee," total : "+_(o(k).length),1),r(s,{style:{"margin-right":"10px",cursor:"pointer"},onClick:z},{default:u(()=>[f(" 삭제 ")]),_:1})]),r(K,{density:"comfortable","fixed-header":"",height:"440"},{default:u(()=>[a("thead",null,[a("tr",null,[a("th",te,[f(" No "),r($,{size:"12pt",icon:o(l)==="id"?o(i)==="asc"?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-subtract-line",onClick:e[0]||(e[0]=n=>g("id"))},null,8,["icon"])]),a("th",se,[f(" Name "),r($,{size:"12pt",icon:o(l)==="name"?o(i)==="asc"?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-subtract-line",onClick:e[1]||(e[1]=n=>g("name"))},null,8,["icon"])]),ne,a("th",ae,[f(" date "),r($,{size:"12pt",icon:o(l)==="date"?o(i)==="asc"?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-subtract-line",onClick:e[2]||(e[2]=n=>g("date"))},null,8,["icon"])]),a("th",oe,[H(a("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=n=>U(m)?m.value=n:null),onChange:N},null,544),[[P,o(m)]])])])]),a("tbody",null,[(b(!0),C(D,null,Y(o(d),(n,v)=>(b(),C("tr",{key:v},[a("td",re,_(n.id),1),a("td",le,[r(s,{class:"text-center",style:{cursor:"pointer",color:"#8C57FF"},onClick:x=>M(n.id)},{default:u(()=>[f(_(n.name),1)]),_:2},1032,["onClick"])]),a("td",ce,_(n.description),1),a("td",ie,_(T(n.date)),1),a("td",de,[a("input",{type:"checkbox",checked:o(c)[v],onChange:q(x=>F(v),["stop"])},null,40,ue)])]))),128))])]),_:1})],64)}}},be={__name:"AdminTable",setup(B){return(T,w)=>(b(),J(O,{class:"mb-2"},{default:u(()=>[r(X,{cols:"12",md:"12"},{default:u(()=>[r(Q,null,{default:u(()=>[r(W,{style:{margin:"10px"}},{default:u(()=>[f("Table")]),_:1}),a("div",null,[r(pe)])]),_:1})]),_:1})]),_:1}))}};export{be as default};
