import{r as u,i as b,E as J,o as k,c as y,a as n,t as d,b as a,w as m,M as i,V as v,I as K,aN as Q,F as P,L as X,P as B,h as D,aO as Z,e as ee}from"./index-Csy_03Ik.js";import{_ as te}from"./PostModal-DYxFwaA8.js";import{V as se}from"./VTable-CVQIvV2I.js";import{V as oe,b as ne,c as ae,a as re}from"./VCard-Dn6rlqdV.js";import"./Reply-DcX9_dpw.js";import"./avatar-1-BeeGmpGQ.js";import"./VSpacer-B8EKNrvY.js";import"./index-Duozb8DO.js";import"./VImg-AgknyUsB.js";import"./VGrid-CkWBtd8r.js";import"./VDivider-COcjAoGG.js";import"./dialog-transition-BELgG3Ok.js";import"./VTextarea-CQUp357K.js";import"./VInput-D2rLtPSR.js";const le={style:{margin:"10px",display:"flex","justify-content":"space-between"}},ie={style:{"font-size":"small","margin-left":"10px"}},ce={class:"text-center"},ue={class:"text-center"},de={class:"text-center"},pe={class:"text-center"},he={class:"text-center"},fe={class:"text-center"},ve={class:"text-center"},me={class:"text-center"},we={class:"text-center",style:{width:"60pt"}},ke={class:"text-center",style:{width:"100pt"}},_e={class:"text-center",style:{width:"100pt"}},ye={class:"text-center",style:{width:"100pt"}},Ce={class:"text-center",style:{width:"100pt"}},$e={class:"text-center",style:{width:"150pt"}},be={class:"text-center",style:{width:"50px"}},xe=["checked","onChange"],ge={key:0,class:"modal-body"},Ie={__name:"AdminPostList",setup(E){const A=function(s){const e=new Date(s),o=e.getFullYear().toString().slice(-2),t=e.getMonth()+1,f=e.getDate();return`${o}-${t}-${f}`},r=u("desc"),l=u("id");function p(s){l.value===s?r.value=r.value==="asc"?"desc":"asc":(l.value=s,r.value="asc"),V()}function V(){const s=c.value.map((e,o)=>e?h.value[o].id:null);h.value.sort((e,o)=>{const t=r.value==="asc"?-1:1;switch(l.value){case"id":return t*(e.postId-o.postId);case"title":return t*e.postTitle.localeCompare(o.postTitle);case"writer":return t*e.userInfo.username.localeCompare(o.userInfo.username);case"table":return t*e.table.name.localeCompare(o.table.name);case"like":return t*(e.likes-o.likes);case"star":return t*(e.stars-o.stars);case"date":return t*(new Date(e.postCreateDt)-new Date(o.postCreateDt));default:return 0}}),c.value=h.value.map(e=>s.includes(e.id))}const C=b("postAddress"),j=b("userAddress"),L=b("tableAddress"),w=b("auth");async function x(){const s=await fetch(`http://${j}/api/getuserid`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w}`},credentials:"include"});if(!s.ok)alert("인증에 실패하였습니다.");else return s.json()}async function G(s){const e=await fetch(`http://${j}/api/whoAreYou/${s}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w}`},credentials:"include"});if(!e.ok)alert("인증에 실패하였습니다.");else return await e.json()}const h=u([]),g=u([]),I=u([]),_=u(!1);async function z(){try{const s=await x(),e=await fetch(`http://${C}/api/post/read/${s}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w}`},credentials:"include"});e.ok||console.error();const o=await e.json();g.value=await Promise.all(o.map(async t=>{const f=await M(t.tableId),T=await N(t.postId),q=await F(t.postId),H=await G(t.userId);return{...t,table:f,likes:T,stars:q,userInfo:H}})),h.value=[...g.value],V()}catch(s){console.error(s)}}z();async function N(s){const e=await fetch(`http://${C}/api/postlike/read/${s}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok)console.error();else return await e.json()}async function F(s){const e=await fetch(`http://${C}/api/poststar/read/${s}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w}`},credentials:"include"});if(!e.ok)console.error();else return await e.json()}async function M(s){const e=await x(),o=await fetch(`http://${L}/api/table/read/${s}/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w}`},credentials:"include"});if(!o.ok)console.error();else return await o.json()}function S(s){_.value=!_.value,I.value=s,Z.emit("PostLikeSortModal",!0)}function U(){_.value=!_.value}async function R(s){const e=await x();(await fetch(`http://${C}/api/post/delete/${s}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w}`},credentials:"include"})).ok?z():(alert(s+"를 삭제할 수 없습니다."),console.error())}const c=u([]);async function Y(){const s=[];if(c.value.forEach((o,t)=>{o&&s.push(h.value[t].postId)}),s.length===0){alert("삭제할 게시물을 선택하십시오.");return}if(confirm("삭제하시겠습니까?"))try{for(const o of s)await R(o);c.value=[],alert("삭제되었습니다.")}catch(o){console.error(o),alert("삭제 실패")}}const $=u(!1);function O(){c.value=h.value.map(()=>$.value)}function W(s){c.value[s]=!c.value[s],$.value=c.value.every(e=>e)}return(s,e)=>{const o=J("VIconBtn");return k(),y(P,null,[n("div",le,[n("span",ie," total : "+d(g.value.length),1),a(o,{style:{"margin-right":"10px",cursor:"pointer"},onClick:Y},{default:m(()=>[i(" 삭제 ")]),_:1})]),a(se,{density:"comfortable","fixed-header":"",height:"440"},{default:m(()=>[n("thead",null,[n("tr",null,[n("th",ce,[i(" No "),a(v,{size:"12pt",icon:l.value==="id"?r.value==="asc"?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-subtract-line",onClick:e[0]||(e[0]=t=>p("id"))},null,8,["icon"])]),n("th",ue,[i(" Title "),a(v,{size:"12pt",icon:l.value==="title"?r.value==="asc"?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-subtract-line",onClick:e[1]||(e[1]=t=>p("title"))},null,8,["icon"])]),n("th",de,[i(" Writer "),a(v,{size:"12pt",icon:l.value==="writer"?r.value==="asc"?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-subtract-line",onClick:e[2]||(e[2]=t=>p("writer"))},null,8,["icon"])]),n("th",pe,[i(" Table "),a(v,{size:"12pt",icon:l.value==="table"?r.value==="asc"?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-subtract-line",onClick:e[3]||(e[3]=t=>p("table"))},null,8,["icon"])]),n("th",he,[i(" Like "),a(v,{size:"12pt",icon:l.value==="like"?r.value==="asc"?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-subtract-line",onClick:e[4]||(e[4]=t=>p("like"))},null,8,["icon"])]),n("th",fe,[i(" Star "),a(v,{size:"12pt",icon:l.value==="star"?r.value==="asc"?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-subtract-line",onClick:e[5]||(e[5]=t=>p("star"))},null,8,["icon"])]),n("th",ve,[i(" Date "),a(v,{size:"12pt",icon:l.value==="date"?r.value==="asc"?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-subtract-line",onClick:e[6]||(e[6]=t=>p("date"))},null,8,["icon"])]),n("th",me,[K(n("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=t=>$.value=t),onChange:O},null,544),[[Q,$.value]])])])]),n("tbody",null,[(k(!0),y(P,null,X(h.value,(t,f)=>(k(),y("tr",{key:f},[n("td",we,d(t.postId),1),n("td",null,[a(o,{class:"text-center",onClick:T=>S(t),style:{cursor:"pointer",color:"#8C57FF"}},{default:m(()=>[i(d(t.postTitle),1)]),_:2},1032,["onClick"])]),n("td",ke,d(t.userInfo.username),1),n("td",_e,d(t.table.name),1),n("td",ye,d(t.likes),1),n("td",Ce,d(t.stars),1),n("td",$e,d(A(t.postCreateDt)),1),n("td",be,[n("input",{type:"checkbox",checked:c.value[f],onChange:B(T=>W(f),["stop"])},null,40,xe)])]))),128))])]),_:1}),_.value?(k(),y("div",{key:0,class:"modal-wrap",onClick:U},[n("div",{class:"modal-container",onClick:e[8]||(e[8]=B(()=>{},["stop"]))},[I.value?(k(),y("div",ge,[a(te,{post:I.value},null,8,["post"])])):D("",!0)])])):D("",!0)],64)}}},Se={__name:"AdminPost",setup(E){return(A,r)=>(k(),ee(oe,{class:"mb-2"},{default:m(()=>[a(re,{cols:"12",md:"12"},{default:m(()=>[a(ne,null,{default:m(()=>[a(ae,{style:{margin:"10px"}},{default:m(()=>[i("Post")]),_:1}),n("div",null,[a(Ie)])]),_:1})]),_:1})]),_:1}))}};export{Se as default};
