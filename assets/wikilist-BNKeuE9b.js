import{_ as se,i as z,H as ie,r as l,l as le,o as v,e as ne,w as c,b as r,a as e,M as oe,I as re,O as de,c as f,L as G,t as w,F as j,n as _,u as g,P as x,Q as ue,R as ce}from"./index-Csy_03Ik.js";import{_ as pe,a as he,b as ve}from"./ViewWikiStarRank-DHqijTNx.js";import{a as C}from"./axios-DkDr-_XN.js";import{V as ge,b as S,c as fe,a as Q}from"./VCard-Dn6rlqdV.js";import"./VTable-CVQIvV2I.js";import"./VGrid-CkWBtd8r.js";import"./VImg-AgknyUsB.js";const I=A=>(ue("data-v-4cbcc590"),A=A(),ce(),A),we={style:{"margin-bottom":"20px",display:"flex"}},_e={style:{"margin-top":"12px","margin-left":"200px"}},me=I(()=>e("option",{value:""},"전체",-1)),ke=["value"],ye={class:"wikititle",border:"0",style:{"border-spacing":"5px",width:"100%","max-height":"300px","overflow-y":"auto"}},be=I(()=>e("tr",{style:{"font-weight":"bold"}},[e("td",{width:"10%",style:{"padding-left":"10px"}}," 번호 "),e("td",{style:{"padding-left":"10px"},width:"55%"}," 제목 "),e("td",{align:"center",width:"10%"}," 사용자 "),e("td",{align:"center",width:"25%"}," 작성일 ")],-1)),$e=I(()=>e("tr",null,[e("td",{colspan:"6"},[e("hr")])],-1)),xe={height:"40"},Ce={style:{"padding-left":"20px"},width:"10%"},Ie={width:"50%"},Ae=["onClick"],Be={width:"20%",align:"center"},Ve={width:"20%",align:"center"},Pe=I(()=>e("tr",null,[e("td",{colspan:"4"},[e("hr")])],-1)),Te=I(()=>e("br",null,null,-1)),ze={style:{display:"flex",gap:"5px","justify-content":"center"}},je={class:"pagination"},Se=["onClick"],Le={__name:"wikilist",setup(A){z("serverAddress");const m=z("wikiAddress"),N=z("userAddress"),L=z("auth");async function M(){const s=await fetch(`http://${N}/api/getuserid`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${L}`},credentials:"include"});if(s.ok)return s.json()}let p="Bearer ";p=p+L;const Y=ie();let R=l(!0),U=l(!0),q=l(!0),J=l(!0),n=l(0),u=l([]),E=l([]),o=l(1);const k=l([]);async function y(){var s;try{const t=await M(),a=await C.get(`http://${m}/api/wiki/read/public/1/${t}?page=${n.value}`,{headers:{Authorization:p}});u.value=a.data.content;const i=a.data.totalPages;Z(i);const d=10,T=(n.value-1)*d,Ee=Math.min(T+d,u.value.length);k.value=[];for(let h=0;h<u.value.length;h++){const D=await C.get(`http://${m}/api/wikilog/readall/${u.value[h].wikiId}/${t}`,{headers:{Authorization:p},withCredentials:!0});k.value.push((s=D.data[0])==null?void 0:s.date.substring(0,10))}$.value=[];const O=[];for(let h=0;h<u.value.length;h++){const D=await H(u.value[h].userId);O.push(D)}return $.value=O,i}catch(t){console.error("Error fetching data:",t)}}y();function K(s){Y.push({name:"readwiki",params:{id:s}})}function X(s){n.value=s-1,y()}const Z=s=>{E.value=[];const t=(o.value-1)*10+1,a=Math.min(o.value*10,s);for(let i=t;i<=a;i++)E.value.push(i)},B=async s=>{const t=await y();switch(s){case"first":n.value=0,o.value=1;break;case"prev":o.value>1&&(n.value=(o.value-2)*10,o.value--);break;case"next":o.value*10<t&&(n.value=o.value*10,o.value++);break;case"last":n.value=t-1,o.value=Math.ceil(t/10);break}y(),F()};le(n,(s,t)=>{F()});const F=()=>{R.value=n.value===0,U.value=n.value>0};F();const W=l([]),V=l(""),P=l([]);async function ee(s){var i;const t=await M(),a=await C.get(`http://${m}/api/category/read/${s}/${t}`,{headers:{Authorization:p},withCredentials:!0});P.value=a.data,k.value=[];for(let d=0;d<P.value.length;d++){const T=await C.get(`http://${m}/api/wikilog/readall/${P.value[d].wikiId}/${t}`,{headers:{Authorization:p},withCredentials:!0});k.value.push((i=T.data[0])==null?void 0:i.date.substring(0,10))}}async function te(){const s=await M(),t=await C.get(`http://${m}/api/category/readall/${s}`,{headers:{Authorization:p},withCredentials:!0});W.value=t.data}te();const b=l(u);async function ae(){$.value=[];const s=[];V.value?(await ee(V.value),b.value=P.value):(await y(),b.value=u.value);for(let t=0;t<b.value.length;t++){const a=await H(b.value[t].userId);s.push(a)}$.value=s}const $=l([]);async function H(s){const t=await fetch(`http://${N}/api/whoAreYou/${s}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${L}`},credentials:"include"});if(!t.ok)alert("인증에 실패하였습니다.");else return await t.json()}return(s,t)=>(v(),ne(ge,null,{default:c(()=>[r(Q,{cols:"12",md:"8",class:"mb-4"},{default:c(()=>[r(S,null,{default:c(()=>[e("div",we,[e("div",null,[r(fe,{color:""},{default:c(()=>[oe("Wiki List")]),_:1})]),e("div",_e,[re(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>V.value=a),onChange:ae},[me,(v(!0),f(j,null,G(W.value,a=>(v(),f("option",{key:a.id,value:a.name},w(a.name),9,ke))),128))],544),[[de,V.value]])])]),e("table",ye,[be,$e,(v(!0),f(j,null,G(b.value,(a,i)=>{var d;return v(),f(j,{key:i},[e("tr",xe,[e("td",Ce,w(a.wikiId),1),e("td",Ie,[e("button",{type:"button",onClick:T=>K(a.wikiId),style:{color:"#905dff"}},w(a.wikiTitle),9,Ae)]),e("td",Be,w((d=$.value[i])==null?void 0:d.username),1),e("td",Ve,w(k.value[i]),1)]),Pe],64)}),128))]),Te,e("div",ze,[e("ul",je,[e("li",{class:_(["page-item",{disabled:g(R)}])},[e("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=x(a=>B("first"),["prevent"]))},"처음")],2),e("li",{class:_(["page-item",{disabled:g(U)}])},[e("a",{class:"page-link",href:"#",onClick:t[2]||(t[2]=x(a=>B("prev"),["prevent"]))},"이전")],2),(v(!0),f(j,null,G(g(E),a=>(v(),f("li",{key:a,class:_(["page-item",{active:g(n)===a}])},[e("a",{class:_(["page-link",{bold:g(n)===a-1}]),href:"#",onClick:x(i=>X(a),["prevent"])},w(a),11,Se)],2))),128)),e("li",{class:_(["page-item",{disabled:g(q)}])},[e("a",{class:"page-link",href:"#",onClick:t[3]||(t[3]=x(a=>B("next"),["prevent"]))},"다음")],2),e("li",{class:_(["page-item",{disabled:g(J)}])},[e("a",{class:"page-link",href:"#",onClick:t[4]||(t[4]=x(a=>B("last"),["prevent"]))},"마지막")],2)])])]),_:1})]),_:1}),r(Q,{cols:"12",md:"4"},{default:c(()=>[r(S,{title:"추천순",style:{"margin-bottom":"20px"}},{default:c(()=>[r(pe,{style:{"margin-bottom":"20px"}})]),_:1}),r(S,{title:"즐겨찾기순",style:{"margin-bottom":"20px"}},{default:c(()=>[r(he,{style:{"margin-bottom":"20px"}})]),_:1}),r(S,{title:"최신순",style:{"margin-bottom":"20px"}},{default:c(()=>[r(ve,{style:{"margin-bottom":"20px"}})]),_:1})]),_:1})]),_:1}))}},He=se(Le,[["__scopeId","data-v-4cbcc590"]]);export{He as default};
