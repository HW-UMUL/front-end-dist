import{_ as de}from"./Post-C260Llot.js";import{_ as ue,i as g,H as oe,r as l,l as pe,o as r,e as q,w as f,a as e,b as h,M as le,I as he,c as d,F as z,L,t as A,O as ve,n as V,u as c,P as N,Q as fe,R as ge,h as E}from"./index-Csy_03Ik.js";import{a as U}from"./axios-DkDr-_XN.js";import{c as me,b as J,V as ae,a as Y}from"./VCard-Dn6rlqdV.js";import{a as ke}from"./avatar-1-BeeGmpGQ.js";import{V as ie}from"./VDivider-COcjAoGG.js";import{b as we}from"./VSpacer-B8EKNrvY.js";import"./PostModal-DYxFwaA8.js";import"./Reply-DcX9_dpw.js";import"./VTextarea-CQUp357K.js";import"./VInput-D2rLtPSR.js";import"./index-Duozb8DO.js";import"./VImg-AgknyUsB.js";import"./VGrid-CkWBtd8r.js";import"./dialog-transition-BELgG3Ok.js";const R=W=>(fe("data-v-2a02e2b9"),W=W(),ge(),W),_e={style:{"margin-bottom":"20px",display:"flex"}},ye={style:{"margin-top":"12px","margin-left":"200px"}},$e=R(()=>e("option",{value:""},"전체",-1)),be=["value"],Ce={class:"wikititle",border:"0",style:{"border-spacing":"5px",width:"100%","max-height":"300px","overflow-y":"auto"}},Ae=R(()=>e("tr",{style:{"font-weight":"bold"}},[e("td",{width:"10%",style:{"padding-left":"10px"}}," 번호 "),e("td",{style:{"padding-left":"10px"},width:"55%"}," 제목 "),e("td",{align:"center",width:"10%"}," 사용자 "),e("td",{align:"center",width:"25%"}," 작성일 ")],-1)),Ie=R(()=>e("tr",null,[e("td",{colspan:"6"},[e("hr")])],-1)),Te={height:"40"},xe={style:{"padding-left":"20px"},width:"10%"},je={width:"50%"},Be=["onClick"],ze={width:"20%",align:"center"},Pe={width:"20%",align:"center"},Ve=R(()=>e("tr",null,[e("td",{colspan:"4"},[e("hr")])],-1)),Ee=R(()=>e("br",null,null,-1)),Le={style:{display:"flex",gap:"5px","justify-content":"center"}},We={class:"pagination"},Ge=["onClick"],Se={__name:"tablewikilist",setup(W){g("serverAddress");const I=g("wikiAddress"),O=g("userAddress"),b=g("auth");async function G(){const s=await fetch(`http://${O}/api/getuserid`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},credentials:"include"});if(s.ok)return s.json()}let w="Bearer ";w=w+b;const _=oe();let S=l(!0),P=l(!0),M=l(!0),H=l(!0),p=l(0),m=l([]),x=l([]),v=l(1);const j=l([]);async function C(){var s;try{const t=await G(),a=await U.get(`http://${I}/api/wiki/read/table/all/${t}`,{headers:{Authorization:w}});m.value=a.data.content;const u=a.data.totalPages;ee(u);const $=10,Q=(p.value-1)*$,Qe=Math.min(Q+$,m.value.length);j.value=[];for(let B=0;B<m.value.length;B++){const te=await U.get(`http://${I}/api/wikilog/readall/${m.value[B].wikiId}/${t}`,{headers:{Authorization:w},withCredentials:!0});j.value.push((s=te.data[0])==null?void 0:s.date.substring(0,10))}F.value=[];const ne=[];for(let B=0;B<m.value.length;B++){const te=await se(m.value[B].userId);ne.push(te)}return F.value=ne,u}catch(t){console.error("Error fetching data:",t)}}C();function X(s){_.push({name:"readwiki",params:{id:s}})}function Z(s){p.value=s-1,C()}const ee=s=>{x.value=[];const t=(v.value-1)*10+1,a=Math.min(v.value*10,s);for(let u=t;u<=a;u++)x.value.push(u)},y=async s=>{const t=await C();switch(s){case"first":p.value=0,v.value=1;break;case"prev":v.value>1&&(p.value=(v.value-2)*10,v.value--);break;case"next":v.value*10<t&&(p.value=v.value*10,v.value++);break;case"last":p.value=t-1,v.value=Math.ceil(t/10);break}C(),i()};pe(p,(s,t)=>{i()});const i=()=>{S.value=p.value===0,P.value=p.value>0};i();const n=l([]),o=l(""),k=l([]);async function K(s){var u;const t=await G(),a=await U.get(`http://${I}/api/category/read/${s}/${t}`,{headers:{Authorization:w},withCredentials:!0});k.value=a.data,j.value=[];for(let $=0;$<k.value.length;$++){const Q=await U.get(`http://${I}/api/wikilog/readall/${k.value[$].wikiId}/${t}`,{headers:{Authorization:w},withCredentials:!0});j.value.push((u=Q.data[0])==null?void 0:u.date.substring(0,10))}}async function re(){const s=await G(),t=await U.get(`http://${I}/api/category/readall/${s}`,{headers:{Authorization:w},withCredentials:!0});n.value=t.data}re();const D=l(m);async function ce(){F.value=[];const s=[];o.value?(await K(o.value),D.value=k.value):(await C(),D.value=m.value);for(let t=0;t<D.value.length;t++){const a=await se(D.value[t].userId);s.push(a)}F.value=s}const F=l([]);async function se(s){const t=await fetch(`http://${O}/api/whoAreYou/${s}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b}`},credentials:"include"});if(!t.ok)alert("인증에 실패하였습니다.");else return await t.json()}return(s,t)=>(r(),q(J,null,{default:f(()=>[e("div",_e,[e("div",null,[h(me,{color:""},{default:f(()=>[le("Wiki List")]),_:1})]),e("div",ye,[he(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>o.value=a),onChange:ce},[$e,(r(!0),d(z,null,L(n.value,a=>(r(),d("option",{key:a.id,value:a.name},A(a.name),9,be))),128))],544),[[ve,o.value]])])]),e("table",Ce,[Ae,Ie,(r(!0),d(z,null,L(D.value,(a,u)=>{var $;return r(),d(z,{key:u},[e("tr",Te,[e("td",xe,A(a.wikiId),1),e("td",je,[e("button",{type:"button",onClick:Q=>X(a.wikiId),style:{color:"#905dff"}},A(a.wikiTitle),9,Be)]),e("td",ze,A(($=F.value[u])==null?void 0:$.username),1),e("td",Pe,A(j.value[u]),1)]),Ve],64)}),128))]),Ee,e("div",Le,[e("ul",We,[e("li",{class:V(["page-item",{disabled:c(S)}])},[e("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=N(a=>y("first"),["prevent"]))},"처음")],2),e("li",{class:V(["page-item",{disabled:c(P)}])},[e("a",{class:"page-link",href:"#",onClick:t[2]||(t[2]=N(a=>y("prev"),["prevent"]))},"이전")],2),(r(!0),d(z,null,L(c(x),a=>(r(),d("li",{key:a,class:V(["page-item",{active:c(p)===a}])},[e("a",{class:V(["page-link",{bold:c(p)===a-1}]),href:"#",onClick:N(u=>Z(a),["prevent"])},A(a),11,Ge)],2))),128)),e("li",{class:V(["page-item",{disabled:c(M)}])},[e("a",{class:"page-link",href:"#",onClick:t[3]||(t[3]=N(a=>y("next"),["prevent"]))},"다음")],2),e("li",{class:V(["page-item",{disabled:c(H)}])},[e("a",{class:"page-link",href:"#",onClick:t[4]||(t[4]=N(a=>y("last"),["prevent"]))},"마지막")],2)])])]),_:1}))}},Me=ue(Se,[["__scopeId","data-v-2a02e2b9"]]),De=e("div",{class:"bar"},null,-1),Fe={key:1},Ne=["onClick"],Ue=["onClick"],Re=["onClick"],Oe=["src"],He=["src"],Ke={class:"my-table-name"},dt={__name:"mytables",setup(W){g("serverAddress");const I=g("profileAddress"),O=g("userAddress"),b=g("tableAddress"),G=g("postAddress"),w=g("wikiAddress");async function T(){const i=await fetch(`http://${O}/api/getuserid`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${_}`},credentials:"include"});if(!i.ok)alert("인증에 실패하였습니다.");else return i.json()}const _=g("auth"),S=oe(),P=l([]),M=l([]);async function H(){const i=await T(),n=await fetch(`http://${b}/api/tableuser/read/accept/${i}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${_}`},credentials:"include"});n.ok?(P.value=await n.json(),X()):alert("실패!")}function p(i){S.push(`/mytables/${i}`)}function m(){S.push("/createtable")}async function x(){const i=await T(),n=await fetch(`http://${b}/api/tableuser/invite/${i}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${_}`},credentials:"include"});n.ok?M.value=await n.json():alert("실패!")}async function v(i){const n=await T();(await fetch(`http://${b}/api/tableuser/update/${i}/${n}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${_}`},credentials:"include"})).ok?(x(),H()):alert("실패!")}async function j(i){const n=await T();(await fetch(`http://${b}/api/tableuser/delete/${i}/${n}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${_}`},credentials:"include"})).ok?x():alert("실패!")}x(),H();const C=l([]);async function X(){const i=await T(),n=await fetch(`http://${G}/api/post/read/table/all/${i}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${_}`},credentials:"include"});if(!n.ok)alert("실패!");else try{C.value=await n.json()}catch{}}const Z=l([]);async function ee(){const i=await T(),n=await fetch(`http://${w}/api/wiki/read/table/all/${i}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${_}`},credentials:"include"});n.ok?Z.value=await n.json():alert("실패!")}ee();const y=l(!0);return(i,n)=>(r(),q(ae,null,{default:f(()=>[h(Y,{cols:"12",md:"8",class:"mb-4"},{default:f(()=>[h(ae,{style:{height:"30px","margin-bottom":"20px"}},{default:f(()=>[e("div",{class:"selectPostWiki",onClick:n[0]||(n[0]=o=>y.value=!0)},"POST"),De,e("div",{class:"selectPostWiki",onClick:n[1]||(n[1]=o=>y.value=!1)},"WIKI")]),_:1}),c(y)?(r(!0),d(z,{key:0},L(c(C),(o,k)=>(r(),d("div",{key:k},[h(de,{post:o,style:{"margin-bottom":"20px"}},null,8,["post"])]))),128)):E("",!0),c(y)?E("",!0):(r(),d("div",Fe,[h(Me)]))]),_:1}),h(Y,{cols:"12",md:"4"},{default:f(()=>[h(J,{title:"Create Table",onClick:m,style:{"margin-bottom":"20px"}}),c(M).length?(r(),q(J,{key:0,title:"Invite Table",style:{"margin-bottom":"20px"}},{default:f(()=>[(r(!0),d(z,null,L(c(M),(o,k)=>(r(),d("div",{key:k},[h(ie),h(we,null,{default:f(()=>[h(ae,null,{default:f(()=>[h(Y,{cols:"12",md:"7",class:"mb-4"},{default:f(()=>[le(A(o.table.name),1)]),_:2},1024),h(Y,{cols:"12",md:"5",class:"mb-4"},{default:f(()=>[e("span",{onClick:K=>v(o.id)},"Accept/",8,Ne),e("span",{onClick:K=>j(o.id)},"Reject",8,Ue)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),_:1})):E("",!0),c(P).length?(r(),q(J,{key:1,title:"My Table",style:{"margin-bottom":"20px"}},{default:f(()=>[(r(!0),d(z,null,L(c(P),(o,k)=>(r(),d("div",{key:k},[h(ie),e("div",{onClick:K=>p(o.table.id),class:"d-flex"},[e("div",null,[o.table.profile?E("",!0):(r(),d("img",{key:0,class:"my-table-img",src:c(ke)},null,8,Oe)),o.table.profile?(r(),d("img",{key:1,class:"my-table-img",src:c(I)+o.table.profile.storeFileName},null,8,He)):E("",!0)]),e("div",Ke,A(o.table.name),1)],8,Re)]))),128))]),_:1})):E("",!0)]),_:1})]),_:1}))}};export{dt as default};
