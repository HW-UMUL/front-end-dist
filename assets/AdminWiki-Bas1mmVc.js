import{r as w,i as y,H,E as P,o as C,c as b,a,t as u,b as r,w as v,M as l,V as k,I as Y,aN as q,F as j,L as J,e as K}from"./index-Csy_03Ik.js";import{V as O}from"./VTable-CVQIvV2I.js";import{V as Q,b as X,c as Z,a as ee}from"./VCard-Dn6rlqdV.js";import"./VGrid-CkWBtd8r.js";import"./VImg-AgknyUsB.js";const te={style:{margin:"10px",display:"flex","justify-content":"space-between"}},se={style:{"font-size":"small","margin-left":"10px"}},ne={class:"text-center"},ae={class:"text-center"},ie={class:"text-center"},re={class:"text-center"},oe={class:"text-center"},le={class:"text-center"},ce={class:"text-center"},ue={class:"text-center"},de={class:"text-center",style:{width:"60pt"}},pe={class:"text-center",style:{width:"100pt"}},he={class:"text-center",style:{width:"100pt"}},we={class:"text-center",style:{width:"100pt"}},ke={class:"text-center",style:{width:"100pt"}},ve={class:"text-center",style:{width:"150pt"}},fe={class:"text-center",style:{width:"50px"}},ye=["checked","onChange"],_e={__name:"AdminWikiList",setup(z){const T=function(s){const e=new Date(s),n=e.getFullYear().toString().slice(-2),t=e.getMonth()+1,h=e.getDate();return`${n}-${t}-${h}`},I=w(!0),o=w("desc"),i=w("id");function d(s){i.value===s?o.value=o.value==="asc"?"desc":"asc":(i.value=s,o.value="asc"),A()}function A(){i.value,i.value,i.value,i.value;const s=c.value.map((e,n)=>e?p.value[n].id:null);p.value.sort((e,n)=>{const t=o.value==="asc"?-1:1;switch(i.value){case"id":return t*(e.wikiId-n.wikiId);case"title":return t*e.wikiTitle.localeCompare(n.wikiTitle);case"category":return t*e.category.name.localeCompare(n.category.name);case"like":return t*(e.likes-n.likes);case"star":return t*(e.stars-n.stars);case"date":return t*(new Date(e.wikiCreateDt)-new Date(n.wikiCreateDt));default:return 0}}),c.value=p.value.map(e=>s.includes(e.id))}y("serverAddress");const _=y("wikiAddress"),D=y("userAddress"),B=y("tableAddress"),f=y("auth"),p=w([]),g=w([]);async function $(){const s=await fetch(`http://${D}/api/getuserid`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`},credentials:"include"});if(!s.ok)alert("인증에 실패하였습니다.");else return s.json()}async function V(){try{const s=await $(),e=await fetch(`http://${_}/api/wiki/read/${s}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`},credentials:"include"});e.ok||console.error(error),I.value=!1;const n=await e.json();g.value=await Promise.all(n.map(async t=>{const h=await L(t.tableId),x=await E(t.wikiId),U=await W(t.wikiId);return{...t,table:h,likes:x,stars:U}})),p.value=[...g.value],A()}catch(s){console.error(s)}}V();async function E(s){const e=await fetch(`http://${_}/api/wikilike/read/${s}`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok)console.error(error);else return await e.json()}async function W(s){const e=await fetch(`http://${_}/api/wikistar/read/${s}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`},credentials:"include"});if(!e.ok)console.error(error);else return await e.json()}async function L(s){const e=await $(),n=await fetch(`http://${B}/api/table/read/${s}/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`},credentials:"include"});if(!n.ok)console.error();else return await n.json()}const F=H();function G(s){F.push({path:`/readwiki/${s}`})}async function N(s){const e=await $();(await fetch(`http://${_}/api/wiki/delete/${s}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"},Authorization:`Bearer ${f}`,credentials:"include"})).ok||(alert(s+"를 삭제할 수 없습니다."),console.error(error))}const c=w([]);async function S(){const s=[];if(c.value.forEach((n,t)=>{n&&s.push(p.value[t].wikiId)}),s.length===0){alert("삭제할 위키를 선택하십시오.");return}if(confirm("삭제하시겠습니까?"))try{for(const n of s)await N(n);c.value=[],alert("삭제되었습니다"),V()}catch(n){console.error(n),alert("삭제 실패")}}const m=w(!1);function M(){c.value=p.value.map(()=>m.value)}function R(s){c.value[s]=!c.value[s],m.value=c.value.every(e=>e)}return(s,e)=>{const n=P("VIconBtn");return C(),b(j,null,[a("div",te,[a("span",se," total : "+u(g.value.length),1),r(n,{style:{"margin-right":"10px",cursor:"pointer"},onClick:S},{default:v(()=>[l(" 삭제 ")]),_:1})]),r(O,{density:"comfortable","fixed-header":"",height:"440"},{default:v(()=>[a("thead",null,[a("tr",null,[a("th",ne,[l(" No "),r(k,{size:"12pt",icon:i.value==="id"?o.value==="asc"?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-subtract-line",onClick:e[0]||(e[0]=t=>d("id"))},null,8,["icon"])]),a("th",ae,[l(" Title "),r(k,{size:"12pt",icon:i.value==="title"?o.value==="asc"?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-subtract-line",onClick:e[1]||(e[1]=t=>d("title"))},null,8,["icon"])]),a("th",ie,[l(" Category "),r(k,{size:"12pt",icon:i.value==="category"?o.value==="asc"?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-subtract-line",onClick:e[2]||(e[2]=t=>d("category"))},null,8,["icon"])]),a("th",re,[l(" Table "),r(k,{size:"12pt",icon:i.value==="table"?o.value==="asc"?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-subtract-line",onClick:e[3]||(e[3]=t=>d("table"))},null,8,["icon"])]),a("th",oe,[l(" Like "),r(k,{size:"12pt",icon:i.value==="like"?o.value==="asc"?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-subtract-line",onClick:e[4]||(e[4]=t=>d("like"))},null,8,["icon"])]),a("th",le,[l(" Star "),r(k,{size:"12pt",icon:i.value==="star"?o.value==="asc"?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-subtract-line",onClick:e[5]||(e[5]=t=>d("star"))},null,8,["icon"])]),a("th",ce,[l(" Date "),r(k,{size:"12pt",icon:i.value==="date"?o.value==="asc"?"ri-arrow-up-s-line":"ri-arrow-down-s-line":"ri-subtract-line",onClick:e[6]||(e[6]=t=>d("date"))},null,8,["icon"])]),a("th",ue,[Y(a("input",{type:"checkbox","onUpdate:modelValue":e[7]||(e[7]=t=>m.value=t),onChange:M},null,544),[[q,m.value]])])])]),a("tbody",null,[(C(!0),b(j,null,J(p.value,(t,h)=>(C(),b("tr",{key:h},[a("td",de,u(t.wikiId),1),a("td",null,[r(n,{class:"text-center",style:{cursor:"pointer",color:"#8C57FF"},onClick:x=>G(t.wikiId)},{default:v(()=>[l(u(t.wikiTitle),1)]),_:2},1032,["onClick"])]),a("td",pe,u(t.category.name),1),a("td",he,u(t.table.name),1),a("td",we,u(t.likes),1),a("td",ke,u(t.stars),1),a("td",ve,u(T(t.wikiCreateDt)),1),a("td",fe,[a("input",{type:"checkbox",checked:c.value[h],onChange:x=>R(h)},null,40,ye)])]))),128))])]),_:1})],64)}}},be={__name:"AdminWiki",setup(z){return(T,I)=>(C(),K(Q,{class:"mb-2"},{default:v(()=>[r(ee,{cols:"12",md:"12"},{default:v(()=>[r(X,null,{default:v(()=>[r(Z,{style:{margin:"10px"}},{default:v(()=>[l("Wiki")]),_:1}),a("div",null,[r(_e)])]),_:1})]),_:1})]),_:1}))}};export{be as default};
