import{i as f,r as d,E as K,o as V,c as j,a as i,u as r,t as R,e as Q,w as n,b as t,V as W,j as X,M as C,h as Z,I as L,a4 as x,N as O,F as B,L as ee}from"./index-Csy_03Ik.js";import{a as te}from"./avatar-1-BeeGmpGQ.js";import{V as se,a as ne,b as N,c as U}from"./VSpacer-B8EKNrvY.js";import{a as k,V as z}from"./VCard-Dn6rlqdV.js";import{V as S}from"./VTextarea-CQUp357K.js";import{V as oe}from"./VDivider-COcjAoGG.js";const ae={class:"mb-2",style:{display:"flex","align-items":"center","font-size":"small",color:"#999"}},le={style:{"margin-right":"10px"}},re=["src"],ie={style:{"margin-right":"5px"}},pe=i("span",null," • ",-1),ce={style:{"margin-left":"5px"}},de={class:"mb-2"},ue=["innerHTML"],ye={__name:"ReplyOption",props:{reply:Object,post:Object,getReply:Function},setup(I){const o=I,A=function(s){const e=new Date(s),$=e.getFullYear(),u=e.getMonth()+1,J=e.getDate(),Y=e.getHours(),q=e.getMinutes();return e.getSeconds(),`${$}-${u}-${J} ${Y}:${q}`},c=f("auth"),y=f("postAddress"),v=f("userAddress"),m=f("userProfileAddress"),g=d({username:"",email:"",password:"",storeFileName:""});async function w(){const s=await fetch(`http://${v}/api/getinfo`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},credentials:"include"});if(!s.ok)console.error();else{const e=await s.json();g.value.username=e[0],g.value.email=e[1],g.value.storeFileName=e[2]}}w();const _=d("");async function l(){const s=await fetch(`http://${v}/api/getuserid`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},credentials:"include"});if(!s.ok)alert("인증에 실패하였습니다.");else{const e=s.json();return _.value=await e,e}}l(),o.getReply(o.post.postId);const p=d(!1),a=d(!1),h=d(!0);function F(){h.value=!h.value,a.value=!a.value}const b=d({content:o.reply.replyContent});async function G(s){const e=await l(),$={content:b.value.content};(await fetch(`http://${y}/api/reply/update/${s}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify($),credentials:"include"})).ok?(a.value=!1,h.value=!0,o.getReply(o.post.postId)):alert("실패!")}async function M(s){const e=await l();confirm("삭제하시겠습니까?")&&((await fetch(`http://${y}/api/reply/delete/${s}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},credentials:"include"})).ok?(alert("삭제되었습니다"),o.getReply(o.post.postId)):alert("삭제 실패"))}async function P(s){const e=await fetch(`http://${v}/api/whoAreYou/${s}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},credentials:"include"});e.ok?T.value=await e.json():alert("인증에 실패하였습니다.")}const T=d([]);P(o.reply.userId);const E=d([]);async function D(){const s=await fetch(`http://${y}/api/replylike/read/${o.reply.replyId}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},credentials:"include"});s.ok&&(E.value=await s.json())}D();async function H(){const s=await l();(await fetch(`http://${y}/api/replylike/check/${o.reply.replyId}/${s}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},credentials:"include"})).ok?D():alert("실패!")}return(s,e)=>{const $=K("VIconBtn");return V(),j(B,null,[i("div",ae,[i("span",le,[i("img",{class:"reply-propile-img",src:r(T).profile?r(m)+r(T).profile:r(te)},null,8,re)]),i("span",ie,R(r(T).username),1),pe,i("span",ce,R(A(o.reply.replyCreateDt)),1),r(_)==I.reply.userId||r(_)==1?(V(),Q($,{key:0,style:{"margin-left":"auto"}},{default:n(()=>[t(W,{ref:"replyoption",icon:"ri-more-2-line",style:{cursor:"pointer"}},null,512),t(se,{modelValue:r(p),"onUpdate:modelValue":e[2]||(e[2]=u=>X(p)?p.value=u:null),activator:s.$refs.replyoption,width:"auto"},{default:n(()=>[t(ne,null,{default:n(()=>[t(N,{link:""},{default:n(()=>[t(U,{onClick:e[0]||(e[0]=u=>F()),style:{"font-size":"small"}},{default:n(()=>[C(" 수정 ")]),_:1})]),_:1}),t(N,{link:""},{default:n(()=>[t(U,{onClick:e[1]||(e[1]=u=>M(o.reply.replyId)),style:{"font-size":"small"}},{default:n(()=>[C(" 삭제 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","activator"])]),_:1})):Z("",!0)]),L(i("div",de,[i("div",{innerHTML:o.reply.replyContent,style:{"white-space":"pre-line"}},null,8,ue)],512),[[x,r(h)]]),L(i("div",null,[i("div",null,[t(z,null,{default:n(()=>[t(k,null,{default:n(()=>[t(S,{input:"",id:"updatereply",modelValue:r(b).content,"onUpdate:modelValue":e[3]||(e[3]=u=>r(b).content=u),placeholder:"수정",label:"수정",rows:"1"},null,8,["modelValue"])]),_:1}),i("div",null,[t(k,{class:"mt-1"},{default:n(()=>[t(O,{onClick:e[4]||(e[4]=u=>G(o.reply.replyId)),type:"button",class:"me-2"},{default:n(()=>[C(" 수정 ")]),_:1})]),_:1})])]),_:1})])],512),[[x,r(a)]]),t(z,{class:"justify-end"},{default:n(()=>[t(k,null,{default:n(()=>[t($,{onClick:H,style:{"font-size":"small",cursor:"pointer"}},{default:n(()=>[C(" 추천 "+R(r(E)),1)]),_:1})]),_:1})]),_:1})],64)}}},fe={class:"mb-2"},_e={__name:"Reply",props:{postob:Object},setup(I){f("serverAddress");const o=f("postAddress"),A=f("userAddress"),c=f("auth"),y=I,v=d([]),m=d({replyContent:""});async function g(){const l=await fetch(`http://${A}/api/getuserid`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},credentials:"include"});if(!l.ok)alert("인증에 실패하였습니다.");else return l.json()}async function w(l){const p=await g();m.value.replyContent;const a=await fetch(`http://${o}/api/reply/readpost/${l}/${p}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},credentials:"include"});a.ok?(v.value=await a.json(),m.value.replyContent=""):alert("실패!")}async function _(l){const p=await g(),a={content:m.value.replyContent};(await fetch(`http://${o}/api/reply/create/${l}/${p}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify(a),credentials:"include"})).ok?w(l):alert("실패!")}return w(y.postob.postId),(l,p)=>(V(),j(B,null,[(V(!0),j(B,null,ee(v.value,(a,h)=>(V(),j("div",{key:h},[t(oe,{class:"mb-2"}),i("div",fe,[t(ye,{getReply:w,reply:a,post:y.postob},null,8,["reply","post"])])]))),128)),t(z,null,{default:n(()=>[t(k,null,{default:n(()=>[t(S,{input:"",id:"reply",modelValue:m.value.replyContent,"onUpdate:modelValue":p[0]||(p[0]=a=>m.value.replyContent=a),placeholder:"댓글",label:"댓글",style:{"white-space":"pre-line"},rows:"1"},null,8,["modelValue"])]),_:1}),i("div",null,[t(k,{class:"mt-1"},{default:n(()=>[t(O,{onClick:p[1]||(p[1]=a=>_(y.postob.postId)),type:"button",class:"me-2"},{default:n(()=>[C(" 작성 ")]),_:1})]),_:1})])]),_:1})],64))}};export{_e as _};
