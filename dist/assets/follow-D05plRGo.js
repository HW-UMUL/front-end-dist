import{i as p,r,t as k,u as c,H as Z,E as ee,o as u,e as oe,w as a,b as s,a as l,c as m,L as B,N as V,M as j,F as O,h as N,j as te,V as se}from"./index-Csy_03Ik.js";import{a as z}from"./avatar-1-BeeGmpGQ.js";import{V as U,b as R,a as D,d as le}from"./VCard-Dn6rlqdV.js";import{V as $}from"./VDivider-COcjAoGG.js";import{V as ae}from"./VTextField-C2KP5el_.js";import"./VGrid-CkWBtd8r.js";import"./VImg-AgknyUsB.js";import"./VInput-D2rLtPSR.js";import"./index-Duozb8DO.js";const P={__name:"GetEmail",props:{userId:String},setup(b){const f=p("userAddress"),h=p("auth"),i=b;async function I(){const w=await fetch(`http://${f}/api/whoAreYou/${i.userId}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`},credentials:"include"});w.ok?d.value=await w.json():alert("인증에 실패하였습니다.")}const d=r([]);return I(),(w,v)=>k(c(d).email)}},ne=l("div",{class:"bar"},null,-1),ie={class:"d-flex"},re=["onClick"],ce=["src"],de={class:"pa-2",style:{"margin-top":"18px","vertical-align":"center"}},ue={class:"d-flex"},pe=["onClick"],fe=["src"],he={class:"pa-2",style:{"margin-top":"18px","vertical-align":"center"}},we={class:"d-flex"},me=["onClick"],ve=["src"],_e={class:"pa-2",style:{"margin-top":"18px","vertical-align":"center"}},xe={__name:"follow",setup(b){p("serverAddress"),p("profileAddress");const f=p("followAddress"),h=p("userAddress"),i=p("auth"),I=Z();async function d(){const e=await fetch(`http://${h}/api/getuserid`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},credentials:"include"});if(!e.ok)alert("인증에 실패하였습니다.");else return e.json()}async function w(e){const o=await fetch(`http://${h}/api/whoAreYou/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},credentials:"include"});if(!o.ok)alert("인증에 실패하였습니다.");else return await o.json()}const v=r(""),G=r([]);async function Y(e){const o={email:e},n=await fetch(`http://${h}/api/whoAreYou/email`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},credentials:"include",body:JSON.stringify(o)});if(!n.ok)alert("인증에 실패하였습니다.");else return n.json()}async function W(){await d();const e=await fetch(`http://${h}/api/search/email/${v.value}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},credentials:"include"});e.ok?G.value=await e.json():alert("실패!")}async function S(e){const o=await d();(await fetch(`http://${f}/api/follow/check/${e}/${o}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},credentials:"include"})).ok?(E(),F()):alert("실패!")}async function H(e){const o=await d(),n=await Y(e);(await fetch(`http://${f}/api/follow/check/${n.userId}/${o}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},credentials:"include"})).ok?(E(),F()):alert("실패!")}const C=r([]),T=r([]);async function E(){const e=await d(),o=await fetch(`http://${f}/api/follow/read/follower/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},credentials:"include"});o.ok?(C.value=await o.json(),M(C)):alert("실패!")}async function F(){const e=await d(),o=await fetch(`http://${f}/api/follow/read/followee/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},credentials:"include"});o.ok?(T.value=await o.json(),q(T)):alert("실패!")}const g=r(!0);function J(e){return x.value.includes(e)?"unFollow":"Follow"}function K(e){return A.value.includes(e)?"unFollow":"Follow"}F(),E();function M(e){x.value=[],A.value=[],e.value.forEach(async function(o){const n=await w(o.followerId);x.value.push(n.email),A.value.push(o.followerId)})}function q(e){Q.value=[],e.value.forEach(async function(o){const n=await w(o.followeeId);X.value.push(n.userId)})}const x=r([]),Q=r([]),A=r([]),X=r([]);function L(e){I.push({path:`/user/${e}`})}return(e,o)=>{const n=ee("IconBtn");return u(),oe(U,null,{default:a(()=>[s(D,{cols:"12",md:"8",class:"mb-4"},{default:a(()=>[s(U,{style:{height:"30px","margin-bottom":"20px"}},{default:a(()=>[l("div",{class:"selectFollowerFollowee",onClick:o[0]||(o[0]=t=>g.value=!0)},"FOLLOWER"),ne,l("div",{class:"selectFollowerFollowee",onClick:o[1]||(o[1]=t=>g.value=!1)},"FOLLOWEE")]),_:1}),s(R,{class:"position-relative"},{default:a(()=>[c(g)?(u(!0),m(O,{key:0},B(c(C),(t,_)=>(u(),m("div",{key:_},[l("div",ie,[l("div",{onClick:y=>L(t.followerId)},[l("img",{class:"follow-propile-img",src:c(z)},null,8,ce)],8,re),l("div",de,[s(P,{userId:t.followerId},null,8,["userId"])]),s(V,{class:"ml-auto",style:{"margin-top":"18px","margin-right":"10px"},onClick:y=>S(t.followerId)},{default:a(()=>[j(" UnFollow ")]),_:2},1032,["onClick"])]),s($)]))),128)):N("",!0),c(g)?N("",!0):(u(!0),m(O,{key:1},B(c(T),(t,_)=>(u(),m("div",{key:_},[l("div",ue,[l("div",{onClick:y=>L(t.followeeId)},[l("img",{class:"follow-propile-img",src:c(z)},null,8,fe)],8,pe),l("div",he,[s(P,{userId:t.followeeId},null,8,["userId"])]),s(V,{class:"ml-auto",style:{"margin-top":"18px","margin-right":"10px"},onClick:y=>S(t.followeeId)},{default:a(()=>[j(k(K(t.followeeId)),1)]),_:2},1032,["onClick"])]),s($)]))),128))]),_:1})]),_:1}),s(D,{cols:"12",md:"4"},{default:a(()=>[s(R,{title:"Search",class:"position-relative"},{default:a(()=>[s(le,null,{default:a(()=>[s(ae,{modelValue:c(v),"onUpdate:modelValue":o[2]||(o[2]=t=>te(v)?v.value=t:null),placeholder:"email",label:"email"},{default:a(()=>[s(n,{style:{position:"absolute",right:"0"},onClick:W},{default:a(()=>[s(se,{icon:"ri-search-line"})]),_:1})]),_:1},8,["modelValue"]),s($)]),_:1}),(u(!0),m(O,null,B(c(G),(t,_)=>(u(),m("div",{key:_},[l("div",we,[l("div",{onClick:y=>e.moveToOtherByEmail(t)},[l("img",{class:"follow-propile-img",src:c(z)},null,8,ve)],8,me),l("div",_e,k(t),1),s(V,{class:"ml-auto",style:{"margin-top":"18px","margin-right":"10px"},onClick:y=>H(t)},{default:a(()=>[j(k(J(t)),1)]),_:2},1032,["onClick"])]),s($)]))),128))]),_:1})]),_:1})]),_:1})}}};export{xe as default};
