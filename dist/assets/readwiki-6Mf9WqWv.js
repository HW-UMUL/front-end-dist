import{_ as it,a as st,b as at}from"./ViewWikiStarRank-DHqijTNx.js";import{a as c}from"./axios-DkDr-_XN.js";import{i as x,a7 as nt,H as ot,aa as I,a9 as rt,r as H,E as lt,o as O,e as dt,w as u,b as a,a as s,t as p,n as F,M as z,c as ct,u as ut,h as mt,N as pt}from"./index-Csy_03Ik.js";import{V as ht,b as A,a as G}from"./VCard-Dn6rlqdV.js";import"./VTable-CVQIvV2I.js";import"./VGrid-CkWBtd8r.js";import"./VImg-AgknyUsB.js";const ft={style:{"margin-top":"2em","margin-left":"3em",display:"flex","justify-content":"space-between"}},kt={style:{"text-align":"left",color:"#905dff",margin:"10px"}},gt={style:{margin:"10px","margin-left":"auto"}},wt={style:{margin:"10px",float:"right"}},yt={class:"kebab-container"},$t={class:"option-list",id:"optionList"},_t={width:"100%",style:{color:"gray","margin-left":"3em"}},bt={key:0},vt=s("br",null,null,-1),Ct=["innerHTML"],xt={class:"button-container",align:"center",style:{flex:"auto",float:"right","margin-bottom":"1em","margin-right":"1em"}},Rt={__name:"readwiki",setup(It){x("serverAddress");const d=x("wikiAddress"),V=x("userAddress"),S=x("auth");async function b(){const t=await fetch(`http://${V}/api/getuserid`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`},credentials:"include"});if(!t.ok)alert("인증에 실패하였습니다.");else return t.json()}let o="Bearer ";o=o+S;const B=nt(),v=ot();let r="";const e=I({items:[],like:[],star:[]}),h=I([]),f=I([]);P();async function P(){const t=await b();c.get(`http://${d}/api/wiki/read/${B.params.id}/${t}`,{headers:{Authorization:o}}).then(i=>{var l,k,g,w,y;e.items=i.data,r=new Date((l=e.items)==null?void 0:l.wikiCreateDt),r=r.getFullYear()+"-"+(r.getMonth()+1).toString().padStart(2,"0")+"-"+r.getDate().toString().padStart(2,"0")+" "+r.getHours().toString().padStart(2,"0")+":"+r.getMinutes().toString().padStart(2,"0")+":"+r.getSeconds().toString().padStart(2,"0"),j((k=e.items)==null?void 0:k.wikiId),R((g=e.items)==null?void 0:g.wikiId),c.get(`http://${d}/api/wikilike/readLikePersonal/${(w=e.items)==null?void 0:w.wikiId}/${t}`,{headers:{Authorization:o}}).then(m=>{var $;e.like=m.data,e.like.wiki!=null&&h.push(($=e.like)==null?void 0:$.wiki.wikiId)}),c.get(`http://${d}/api/wikistar/readStarPersonal/${(y=e.items)==null?void 0:y.wikiId}/${t}`,{headers:{Authorization:o}}).then(m=>{e.star=m.data,e.star.wiki!=null&&f.push(e.star.wiki.wikiId)})})}function Y(t){v.push({path:`/updatewiki/${t}`})}function W(t){v.push({path:`/wikilog/${t}`})}async function q(){if(confirm("정말로 삭제하시겠습니까?")){const t=await b();c.delete(`http://${d}/api/wiki/delete/${B.params.id}/${t}`,{headers:{Authorization:o}}).then(i=>{v.push("/wiki")}).catch(i=>{console.error("삭제 중 에러가 발생했습니다:",i)})}}const C=I({like:{},star:{}});async function J(t){L(t)?h.splice(h.indexOf(t),1):h.push(t),await Q(t)}async function K(t){T(t)?f.splice(f.indexOf(t),1):f.push(t),await X(t)}function L(t){return h.includes(t)}function T(t){return f.includes(t)}async function Q(t){const i=await b();await c.create({baseURL:`http://${d}/api/wikilike/check/${t}/${i}`,headers:{Authorization:o},withCredentials:!0}).post(),j(t)}async function X(t){const i=await b();await c.create({baseURL:`http://${d}/api/wikistar/check/${t}/${i}`,headers:{Authorization:o},withCredentials:!0}).post(),R(t)}async function j(t){const l=(await c.create({baseURL:`http://${d}/api/wikilike/read/${t}`,headers:{Authorization:o},withCredentials:!0}).get()).data;C.like[t]=l}async function R(t){const l=(await c.create({baseURL:`http://${d}/api/wikistar/read/${t}`,headers:{Authorization:o},withCredentials:!0}).get()).data;C.star[t]=l}const Z=()=>{v.push("/wiki")};function tt(){var t=document.getElementById("optionList");t.style.display==="none"?t.style.display="block":t.style.display="none"}async function et(){const t=await fetch(`http://${V}/api/whoAreYou/${e.items.userId}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`},credentials:"include"});t.ok?E.value=await t.json():alert("인증에 실패하였습니다.")}rt(()=>{try{e.items.userId&&et().then(()=>{U.value=!0})}catch{}});const U=H(!1),E=H();return(t,i)=>{const l=lt("font-awesome-icon");return O(),dt(ht,null,{default:u(()=>[a(G,{cols:"12",md:"8",class:"mb-4"},{default:u(()=>[a(A,null,{default:u(()=>{var k,g,w,y,m,$,M,N,D;return[s("div",ft,[s("div",kt,p((k=e.items.category)==null?void 0:k.name),1),s("div",gt,[s("button",{type:"button",onClick:i[0]||(i[0]=_=>{var n;return J((n=e.items)==null?void 0:n.wikiId)}),class:F({active:L((g=e.items)==null?void 0:g.wikiId)})},[a(l,{icon:L((w=e.items)==null?void 0:w.wikiId)?["fas","thumbs-up"]:["far","thumbs-up"]},null,8,["icon"])],2),z(" "+p(C.like[(y=e.items)==null?void 0:y.wikiId]),1)]),s("div",wt,[s("button",{type:"button",onClick:i[1]||(i[1]=_=>{var n;return K((n=e.items)==null?void 0:n.wikiId)}),class:F({active:T((m=e.items)==null?void 0:m.wikiId)})},[a(l,{icon:T(($=e.items)==null?void 0:$.wikiId)?["fas","star"]:["far","star"]},null,8,["icon"])],2),z(" "+p(C.star[(M=e.items)==null?void 0:M.wikiId]),1)]),s("div",yt,[s("div",{style:{margin:"10px","margin-right":"3.5em"},class:"kebab-icon",onClick:i[2]||(i[2]=_=>tt())}," ••• "),s("ul",$t,[s("li",null,[s("a",{onClick:i[3]||(i[3]=_=>{var n;return W((n=e.items)==null?void 0:n.wikiId)})},"변경 이력")]),s("li",null,[s("a",{onClick:i[4]||(i[4]=_=>{var n;return Y((n=e.items)==null?void 0:n.wikiId)})},"수정")]),s("li",null,[s("a",{onClick:i[5]||(i[5]=_=>q())},"삭제")])])])]),s("div",_t,[s("h1",null,p((N=e.items)==null?void 0:N.wikiTitle),1),U.value?(O(),ct("p",bt,"  "+p(E.value.username)+"   "+p(ut(r))+"에 최종 변경",1)):mt("",!0)]),vt,s("div",{innerHTML:`${(D=e.items)==null?void 0:D.wikiContent}`,style:{"margin-left":"3em","margin-right":"3em",height:"50%"}},null,8,Ct),s("div",xt,[a(pt,{onClick:Z},{default:u(()=>[z(" 목록")]),_:1})])]}),_:1})]),_:1}),a(G,{cols:"12",md:"4"},{default:u(()=>[a(A,{title:"추천순",style:{"margin-bottom":"20px"}},{default:u(()=>[a(it,{style:{"margin-bottom":"20px"}})]),_:1}),a(A,{title:"즐겨찾기순",style:{"margin-bottom":"20px"}},{default:u(()=>[a(st,{style:{"margin-bottom":"20px"}})]),_:1}),a(A,{title:"최신순",style:{"margin-bottom":"20px"}},{default:u(()=>[a(at,{style:{"margin-bottom":"20px"}})]),_:1})]),_:1})]),_:1})}}};export{Rt as default};
